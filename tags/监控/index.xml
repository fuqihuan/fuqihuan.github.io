<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>监控 on inorz.net</title>
    <link>http://inorz.net/tags/%E7%9B%91%E6%8E%A7/index.xml</link>
    <description>Recent content in 监控 on inorz.net</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <copyright>©2015-2017 ღ fuqihuan</copyright>
    <atom:link href="http://inorz.net/tags/%E7%9B%91%E6%8E%A7/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>InfluxDB、Glances和Grafana构建现代化监控系统</title>
      <link>http://inorz.net/2016/05/22/influxdb_grafana_glances_monitor/</link>
      <pubDate>Sun, 22 May 2016 23:55:48 +0000</pubDate>
      
      <guid>http://inorz.net/2016/05/22/influxdb_grafana_glances_monitor/</guid>
      <description>&lt;p&gt;今天的主角是InfluxDB、Glances、Grafana这三个工具，三个工作都非常强大。可以用于组件一个比较强大的分布式监控系统了，关键是文档也比较齐全。&lt;/p&gt;

&lt;p&gt;简单介绍一下这三款软件：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://influxdata.com&#34;&gt;InfluxDB&lt;/a&gt;: InfluxDB 是一个开源，分布式，时间序列，事件，可度量和无外部依赖的数据库。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://nicolargo.github.io/glances/&#34;&gt;Glances&lt;/a&gt;: glances 是一款用于 Linux、BSD 的开源命令行系统监视工具，它使用 Python 语言开发，能够监视 CPU、负载、内存、磁盘 I/O、网络流量、文件系统、系统温度等信息。本文介绍 glances 的使用方法和技巧，帮助 Linux 系统管理员了解掌握服务器性能。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://grafana.org/&#34;&gt;Grafana&lt;/a&gt;: grafana 是一款采用go 语言编写的开源应用，主要用于大规模指标数据的可视化展现。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;下面我们说一下具体的部署过程：&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h2 id=&#34;部署环境&#34;&gt;部署环境&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;监控对象：MAC机器&lt;/li&gt;
&lt;li&gt;监控平台：InfluxDB+Grafana，安装在一台CentOS机器上。(192.168.99.9)&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;部署过程&#34;&gt;部署过程&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;InfluxDB(192.168.99.9)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;安装&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;CentOS 6.2
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#下载：
wget https://dl.influxdata.com/influxdb/releases/influxdb-0.13.0.x86_64.rpm
#安装：
sudo yum localinstall influxdb-0.13.0.x86_64.rpm
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;其他操作系统: &lt;a href=&#34;https://influxdata.com/downloads/#influxdb&#34;&gt;详见官方文档&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;配置和启动&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# 运行influxdb
sudo /etc/init.d/influxdb start
    
# 创建数据库
curl &#39;http://192.168.8.172:8086/query?q=CREATE+DATABASE+&amp;quot;inorz_db_name&amp;quot;&#39;

# 查询已经创建的数据库
curl &#39;http://localhost:8086/query?q=SHOW+DATABASES&#39;
    
# 也可以直接登录WEB界面进行操作和查询
# 访问地址：http://192.168.99.9:8083
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Glances&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;安装: 在被监控机器上安装，这里我们要监控的机器是一台MAC机器。
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;pip install glances --user
pip install influxdb --user
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;配置和启动
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo vim /etc/glances.conf
# 输入以下内容后保存退出
host=192.168.99.9
port=8086
ser=root
password=root
db=inorz_db_name
    
# 运行
glances --export-influxdb -C /etc/glances.conf
    
# 如果需要后台运行，挂掉又可自动拉启。可以用supervisor来托管服务
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;如果客户端和监控端之间防火墙已经配置互通了的话，这回数据应该是可以正常发送到influxdb去了的。可以通过以下命令来查询有没有指标入库：
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;curl &#39;http://192.168.99.9:8086/query?q=SHOW+MEASUREMENTS&amp;amp;db=glances&#39;
# 反馈来的是一串json
{&amp;quot;results&amp;quot;:[{&amp;quot;series&amp;quot;:[{&amp;quot;name&amp;quot;:&amp;quot;measurements&amp;quot;,&amp;quot;columns&amp;quot;:[&amp;quot;name&amp;quot;],&amp;quot;values&amp;quot;:[[&amp;quot;cpu&amp;quot;],[&amp;quot;diskio&amp;quot;],[&amp;quot;fs&amp;quot;],[&amp;quot;load&amp;quot;],[&amp;quot;mem&amp;quot;],[&amp;quot;memswap&amp;quot;],[&amp;quot;network&amp;quot;],[&amp;quot;percpu&amp;quot;],[&amp;quot;processcount&amp;quot;],[&amp;quot;system&amp;quot;]]}]}]}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Grafana(192.168.99.9)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;安装

&lt;ul&gt;
&lt;li&gt;CentOS 6.2
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;   # 下载：
   wget https://grafanarel.s3.amazonaws.com/builds/grafana-3.0.2-1463383025.linux-x64.tar.gz
   # 解压并启动
   tar xf grafana-3.0.2-1463383025.linux-x64.tar.gz
   cd grafana-3.0.2-1463383025/bin/
   ./grafana-server
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;其他操作系统: &lt;a href=&#34;http://grafana.org/download/&#34;&gt;详见官方文档&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;配置&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;直接在浏览器上进行配置：&lt;a href=&#34;http://192.168.99.9:3000&#34;&gt;http://192.168.99.9:3000&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;默认账密为admin,admin&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;添加数据源
&lt;img src=&#34;http://inorz.net/images/grafana-add-data-influxdb.png&#34; alt=&#34;grafana-dd-data-influxdb&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;添加Graph
&lt;img src=&#34;http://inorz.net/images/grafana_add_graph.png&#34; alt=&#34;grafana_add_graph&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;填入查询语句（可以到influxdb的WEB页面操作查询，语法和SQL差不多，非常简单）。这里我们填入查询复杂信息的语句。
&lt;img src=&#34;http://inorz.net/images/grafana_add_graph_edit.png&#34; alt=&#34;grafana_add_graph_edit&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;效果图
下面是我自己简单配置的一个监控图形，有兴趣的可以自己发挥。
&lt;img src=&#34;http://inorz.net/images/grafana_dashboards.png&#34; alt=&#34;grafana_dashboards&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;faq&#34;&gt;FAQ&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;连接不上数据库，访问页面超时。首先检查一下安装过程以及配置，启动时是否有报错，另外看防火墙是否配置正确。&lt;/p&gt;

&lt;h2 id=&#34;其他&#34;&gt;其他&lt;/h2&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;以上为个人的一个安装和配置过程，如有不对，请多多指正。&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
    </item>
    
  </channel>
</rss>